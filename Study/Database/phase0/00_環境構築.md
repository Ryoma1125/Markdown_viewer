# Phase 0: 環境構築 ～ Docker で MySQL を動かす ～

## 学習目標

この単元を終えると、以下ができるようになります：

- Docker で MySQL コンテナを起動できる
- MySQL クライアントで接続できる
- 基本的なデータベース操作を確認できる

## MySQL 環境の構築

### Docker Compose で MySQL を起動

```bash
mkdir -p ~/db-practice
cd ~/db-practice

cat << 'EOF' > docker-compose.yml
version: '3.8'

services:
  mysql:
    image: mysql:8.0
    container_name: mysql-practice
    environment:
      MYSQL_ROOT_PASSWORD: rootpass
      MYSQL_DATABASE: practice
      MYSQL_USER: student
      MYSQL_PASSWORD: studentpass
    ports:
      - "3306:3306"
    volumes:
      - mysql_data:/var/lib/mysql
    command: --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci

volumes:
  mysql_data:
EOF

# 起動
docker compose up -d

# 起動確認
docker compose ps
```

### MySQL に接続

```bash
# コンテナ内の mysql クライアントを使用
docker exec -it mysql-practice mysql -u student -pstudentpass practice

# 接続できたら以下を試す
mysql> SHOW DATABASES;
mysql> SELECT VERSION();
mysql> exit
```

### GUI ツール（任意）

```bash
# Adminer（Web ベースの管理ツール）を追加
cat << 'EOF' >> docker-compose.yml

  adminer:
    image: adminer
    container_name: adminer
    ports:
      - "8080:8080"
EOF

docker compose up -d

# ブラウザで http://localhost:8080 にアクセス
# サーバー: mysql, ユーザー: student, パスワード: studentpass
```

## 動作確認

```bash
docker exec -it mysql-practice mysql -u student -pstudentpass practice << 'EOF'
-- テスト用テーブル作成
CREATE TABLE IF NOT EXISTS test (
    id INT AUTO_INCREMENT PRIMARY KEY,
    message VARCHAR(100)
);

-- データ挿入
INSERT INTO test (message) VALUES ('Hello, Database!');

-- データ確認
SELECT * FROM test;

-- テーブル削除
DROP TABLE test;
EOF
```

## トラブルシューティング

```bash
# コンテナが起動しない場合
docker compose logs mysql

# ポートが使用中の場合
lsof -i :3306
# → 別のプロセスが使用中なら停止するか、docker-compose.yml のポートを変更

# 完全にリセットしたい場合
docker compose down -v  # ボリュームも削除
docker compose up -d
```

## 次のステップ

環境が整いました！次はデータベースの基本概念を学びましょう。

**次の単元**: [Phase 1: データベースとは](../phase1/01_データベースとは.md)
