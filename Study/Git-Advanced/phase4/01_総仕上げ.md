# Phase 4: ç·ä»•ä¸Šã’ ï½ ãƒãƒ¼ãƒ é–‹ç™ºã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ï½

## å­¦ç¿’ç›®æ¨™

ã“ã®å˜å…ƒã‚’çµ‚ãˆã‚‹ã¨ã€ä»¥ä¸‹ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼š

- å®Ÿéš›ã®ãƒãƒ¼ãƒ é–‹ç™ºãƒ•ãƒ­ãƒ¼ã‚’ä½“é¨“ã§ãã‚‹
- Git/GitHub ã®çŸ¥è­˜ã‚’ç·åˆçš„ã«æ´»ç”¨ã§ãã‚‹
- ã‚ˆãã‚ã‚‹å•é¡Œã«å¯¾å‡¦ã§ãã‚‹

## ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³: Web API ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ

### ã‚·ãƒŠãƒªã‚ª

ã‚ãªãŸã¯3äººãƒãƒ¼ãƒ ã§ REST API ã‚’é–‹ç™ºã—ã¦ã„ã¾ã™ã€‚

- **ã‚ãªãŸ**: ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼æ©Ÿèƒ½ã‚’æ‹…å½“
- **Aã•ã‚“**: å•†å“ç®¡ç†æ©Ÿèƒ½ã‚’æ‹…å½“
- **Bã•ã‚“**: æ³¨æ–‡æ©Ÿèƒ½ã‚’æ‹…å½“

### æ¼”ç¿’1: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆæœŸè¨­å®š

```bash
mkdir -p ~/git-practice/team-project
cd ~/git-practice/team-project
git init

# åŸºæœ¬æ§‹é€ 
mkdir -p src/{auth,products,orders} tests .github/{workflows,ISSUE_TEMPLATE}

# README
cat << 'EOF' > README.md
# ãƒãƒ¼ãƒ é–‹ç™º API

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
```bash
pip install -r requirements.txt
```

## ãƒ†ã‚¹ãƒˆ
```bash
pytest
```

## ãƒ–ãƒ©ãƒ³ãƒæˆ¦ç•¥
- `main`: æœ¬ç•ªãƒªãƒªãƒ¼ã‚¹
- `develop`: é–‹ç™ºçµ±åˆ
- `feature/*`: æ©Ÿèƒ½é–‹ç™º
EOF

# åˆæœŸãƒ•ã‚¡ã‚¤ãƒ«
echo "flask==3.0.0" > requirements.txt
touch src/__init__.py src/auth/__init__.py

git add .
git commit -m "Initial project setup"

# develop ãƒ–ãƒ©ãƒ³ãƒä½œæˆ
git checkout -b develop
git checkout main
```

### æ¼”ç¿’2: æ©Ÿèƒ½é–‹ç™ºï¼ˆè‡ªåˆ†ã®ã‚¿ã‚¹ã‚¯ï¼‰

```bash
cd ~/git-practice/team-project
git checkout develop
git pull origin develop 2>/dev/null || true

# feature ãƒ–ãƒ©ãƒ³ãƒä½œæˆ
git checkout -b feature/user-auth

# èªè¨¼ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ä½œæˆ
cat << 'EOF' > src/auth/user.py
from dataclasses import dataclass
from typing import Optional
import hashlib
import secrets

@dataclass
class User:
    id: int
    email: str
    password_hash: str
    
    @staticmethod
    def hash_password(password: str) -> str:
        salt = secrets.token_hex(16)
        return f"{salt}:{hashlib.sha256((salt + password).encode()).hexdigest()}"
    
    def verify_password(self, password: str) -> bool:
        salt, hash_value = self.password_hash.split(':')
        return hash_value == hashlib.sha256((salt + password).encode()).hexdigest()
EOF

cat << 'EOF' > tests/test_auth.py
from src.auth.user import User

def test_password_hashing():
    password = "secure123"
    hash1 = User.hash_password(password)
    hash2 = User.hash_password(password)
    # æ¯å›ç•°ãªã‚‹ãƒãƒƒã‚·ãƒ¥ï¼ˆã‚½ãƒ«ãƒˆãŒé•ã†ï¼‰
    assert hash1 != hash2

def test_password_verification():
    password = "secure123"
    user = User(id=1, email="test@example.com", password_hash=User.hash_password(password))
    assert user.verify_password(password) == True
    assert user.verify_password("wrong") == False
EOF

# ã‚³ãƒŸãƒƒãƒˆ
git add .
git commit -m "feat(auth): add User class with password hashing"

# ã•ã‚‰ã«é–‹ç™º
cat << 'EOF' > src/auth/token.py
import secrets
from datetime import datetime, timedelta
from typing import Optional

class TokenManager:
    _tokens: dict = {}
    
    @classmethod
    def generate_token(cls, user_id: int, expires_in: int = 3600) -> str:
        token = secrets.token_urlsafe(32)
        cls._tokens[token] = {
            'user_id': user_id,
            'expires_at': datetime.now() + timedelta(seconds=expires_in)
        }
        return token
    
    @classmethod
    def verify_token(cls, token: str) -> Optional[int]:
        if token not in cls._tokens:
            return None
        data = cls._tokens[token]
        if datetime.now() > data['expires_at']:
            del cls._tokens[token]
            return None
        return data['user_id']
EOF

git add .
git commit -m "feat(auth): add token management"
```

### æ¼”ç¿’3: ã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ

```bash
# Aã•ã‚“ã®å¤‰æ›´ã‚’æ¨¡æ“¬ï¼ˆdevelop ã«ç›´æ¥ï¼‰
git checkout develop
cat << 'EOF' > src/__init__.py
# Main application
VERSION = "0.1.0"
EOF
git add . && git commit -m "chore: add version"

# è‡ªåˆ†ã®ãƒ–ãƒ©ãƒ³ãƒã§ã‚‚åŒã˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¤‰æ›´
git checkout feature/user-auth
cat << 'EOF' > src/__init__.py
# Auth module exports
from src.auth.user import User
from src.auth.token import TokenManager
EOF
git add . && git commit -m "feat(auth): export auth modules"

# develop ã®æœ€æ–°ã‚’å–ã‚Šè¾¼ã‚‚ã†ã¨ã™ã‚‹
git rebase develop

# ã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆç™ºç”Ÿï¼è§£æ±º
cat << 'EOF' > src/__init__.py
# Main application
VERSION = "0.1.0"

# Auth module exports
from src.auth.user import User
from src.auth.token import TokenManager
EOF

git add .
git rebase --continue
```

### æ¼”ç¿’4: PR ä½œæˆã¨ãƒ¬ãƒ“ãƒ¥ãƒ¼

```bash
# PR ç”¨ã®èª¬æ˜ã‚’æº–å‚™
cat << 'EOF'
## æ¦‚è¦
ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼æ©Ÿèƒ½ã®åŸºç›¤å®Ÿè£…

## å¤‰æ›´å†…å®¹
- User ã‚¯ãƒ©ã‚¹: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥åŒ–ã€æ¤œè¨¼æ©Ÿèƒ½
- TokenManager: ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆã€æ¤œè¨¼æ©Ÿèƒ½
- ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆè¿½åŠ 

## é–¢é€£ Issue
Closes #1

## ãƒ†ã‚¹ãƒˆ
- [x] ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥åŒ–ãƒ†ã‚¹ãƒˆ
- [x] ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¤œè¨¼ãƒ†ã‚¹ãƒˆ
- [x] ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆãƒ»æ¤œè¨¼ãƒ†ã‚¹ãƒˆ

## ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
- [x] ã‚³ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«æº–æ‹ 
- [x] ãƒ†ã‚¹ãƒˆè¿½åŠ 
- [x] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®ï¼ˆã‚½ãƒ«ãƒˆä»˜ããƒãƒƒã‚·ãƒ¥ï¼‰
EOF

# develop ã«ãƒãƒ¼ã‚¸
git checkout develop
git merge --no-ff feature/user-auth -m "Merge PR #1: Add user authentication"
git branch -d feature/user-auth
```

### æ¼”ç¿’5: ãƒ›ãƒƒãƒˆãƒ•ã‚£ãƒƒã‚¯ã‚¹

```bash
# æœ¬ç•ªã§ãƒã‚°ç™ºè¦‹ï¼
git checkout main

# hotfix ãƒ–ãƒ©ãƒ³ãƒ
git checkout -b hotfix/token-expiry

# ä¿®æ­£
cat << 'EOF' > src/auth/token.py
import secrets
from datetime import datetime, timedelta
from typing import Optional

class TokenManager:
    _tokens: dict = {}
    
    @classmethod
    def generate_token(cls, user_id: int, expires_in: int = 3600) -> str:
        token = secrets.token_urlsafe(32)
        cls._tokens[token] = {
            'user_id': user_id,
            'expires_at': datetime.now() + timedelta(seconds=expires_in)
        }
        return token
    
    @classmethod
    def verify_token(cls, token: str) -> Optional[int]:
        if token not in cls._tokens:
            return None
        data = cls._tokens[token]
        if datetime.now() > data['expires_at']:
            del cls._tokens[token]
            return None
        return data['user_id']
    
    @classmethod
    def revoke_token(cls, token: str) -> bool:
        """ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç„¡åŠ¹åŒ–"""
        if token in cls._tokens:
            del cls._tokens[token]
            return True
        return False
EOF

git add .
git commit -m "fix(auth): add token revocation"

# main ã«ãƒãƒ¼ã‚¸
git checkout main
git merge --no-ff hotfix/token-expiry -m "Hotfix: Add token revocation"
git tag -a v1.0.1 -m "Version 1.0.1 - Token revocation fix"

# develop ã«ã‚‚åæ˜ 
git checkout develop
git merge hotfix/token-expiry

git branch -d hotfix/token-expiry
```

### æ¼”ç¿’6: ãƒªãƒªãƒ¼ã‚¹

```bash
# ãƒªãƒªãƒ¼ã‚¹ãƒ–ãƒ©ãƒ³ãƒä½œæˆ
git checkout develop
git checkout -b release/1.1.0

# ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ›´æ–°
sed -i '' 's/VERSION = "0.1.0"/VERSION = "1.1.0"/' src/__init__.py
git add . && git commit -m "chore: bump version to 1.1.0"

# main ã«ãƒãƒ¼ã‚¸
git checkout main
git merge --no-ff release/1.1.0 -m "Release 1.1.0"
git tag -a v1.1.0 -m "Version 1.1.0"

# develop ã«ã‚‚åæ˜ 
git checkout develop
git merge release/1.1.0

git branch -d release/1.1.0

# å±¥æ­´ç¢ºèª
git log --oneline --graph --all
```

## Git/GitHub ç·åˆãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

```markdown
## åŸºæœ¬æ“ä½œ
- [ ] commit, push, pull ãŒå•é¡Œãªãã§ãã‚‹
- [ ] ãƒ–ãƒ©ãƒ³ãƒã®ä½œæˆãƒ»åˆ‡ã‚Šæ›¿ãˆãƒ»å‰Šé™¤ãŒã§ãã‚‹

## ãƒ–ãƒ©ãƒ³ãƒæˆ¦ç•¥
- [ ] Git Flow / GitHub Flow ã‚’èª¬æ˜ã§ãã‚‹
- [ ] é©åˆ‡ãªãƒ–ãƒ©ãƒ³ãƒå‘½åãŒã§ãã‚‹

## ãƒãƒ¼ã‚¸
- [ ] merge ã¨ rebase ã®é•ã„ã‚’èª¬æ˜ã§ãã‚‹
- [ ] ã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆã‚’è§£æ±ºã§ãã‚‹
- [ ] squash merge ã‚’ä½¿ãˆã‚‹

## å±¥æ­´æ“ä½œ
- [ ] commit --amend ã‚’ä½¿ãˆã‚‹
- [ ] rebase -i ã§ã‚³ãƒŸãƒƒãƒˆã‚’æ•´ç†ã§ãã‚‹
- [ ] reset ã®ç¨®é¡ã‚’ç†è§£ã—ã¦ã„ã‚‹

## PR / ãƒ¬ãƒ“ãƒ¥ãƒ¼
- [ ] è‰¯ã„ PR ã‚’ä½œæˆã§ãã‚‹
- [ ] å»ºè¨­çš„ãªãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒã§ãã‚‹
- [ ] ãƒ¬ãƒ“ãƒ¥ãƒ¼æŒ‡æ‘˜ã«é©åˆ‡ã«å¯¾å¿œã§ãã‚‹

## GitHub æ©Ÿèƒ½
- [ ] Issues ã§ã‚¿ã‚¹ã‚¯ç®¡ç†ãŒã§ãã‚‹
- [ ] GitHub Actions ã§è‡ªå‹•åŒ–ã§ãã‚‹
- [ ] CODEOWNERS ã‚’è¨­å®šã§ãã‚‹
```

## ã‚ˆãã‚ã‚‹ãƒˆãƒ©ãƒ–ãƒ«ã¨å¯¾å‡¦

| ãƒˆãƒ©ãƒ–ãƒ« | å¯¾å‡¦æ³• |
|---------|--------|
| é–“é•ã£ãŸãƒ–ãƒ©ãƒ³ãƒã«ã‚³ãƒŸãƒƒãƒˆ | `git cherry-pick` ã§ç§»å‹•ã€`reset` ã§å–æ¶ˆ |
| push å¾Œã«ã‚³ãƒŸãƒƒãƒˆä¿®æ­£ã—ãŸã„ | æ–°ã—ã„ã‚³ãƒŸãƒƒãƒˆã§ä¿®æ­£ã€force push ã¯é¿ã‘ã‚‹ |
| ãƒãƒ¼ã‚¸å¾Œã«ãƒã‚°ç™ºè¦‹ | `git revert` ã§ãƒãƒ¼ã‚¸ã‚’å–ã‚Šæ¶ˆã— |
| ãƒ–ãƒ©ãƒ³ãƒã‚’é–“é•ãˆã¦å‰Šé™¤ | `git reflog` ã‹ã‚‰å¾©æ—§ |

## ğŸ‰ Git/GitHub å¿œç”¨ å®Œäº†ï¼

### å­¦ç¿’ã®ç·ã¾ã¨ã‚

| Phase | å­¦ã‚“ã ã“ã¨ |
|-------|-----------|
| 1 | ãƒ–ãƒ©ãƒ³ãƒæˆ¦ç•¥ã€ãƒãƒ¼ã‚¸ vs ãƒªãƒ™ãƒ¼ã‚¹ |
| 2 | ã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆè§£æ±ºã€å±¥æ­´æ›¸ãæ›ãˆ |
| 3 | PR é‹ç”¨ã€GitHub æ©Ÿèƒ½æ´»ç”¨ |
| 4 | ãƒãƒ¼ãƒ é–‹ç™ºã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ |

### æ¬¡ã«å­¦ã¶ã¹ãã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ 

- **CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³** - GitHub Actions ã®æœ¬æ ¼æ´»ç”¨
- **è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³** - ã‚³ãƒ¼ãƒ‰å“è³ªå‘ä¸Š

---

**ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼ğŸ™**
