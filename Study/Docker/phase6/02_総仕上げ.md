# Phase 6-2: ç·ä»•ä¸Šã’ ï½ å®Ÿè·µãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ ï½

## å­¦ç¿’ç›®æ¨™

ã“ã®å˜å…ƒã‚’çµ‚ãˆã‚‹ã¨ã€ä»¥ä¸‹ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼š

- å®Ÿè·µçš„ãª Docker ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä¸€ã‹ã‚‰æ§‹ç¯‰ã§ãã‚‹
- Docker ã®çŸ¥è­˜ã‚’ä½“ç³»çš„ã«æ•´ç†ãƒ»ç¢ºèªã§ãã‚‹
- æœ¬ç•ªé‹ç”¨ã‚’æ„è­˜ã—ãŸãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã‚’é©ç”¨ã§ãã‚‹
- ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è‡ªåŠ›ã§è¡Œãˆã‚‹

## å®Ÿè·µãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ: ãƒã‚¤ã‚¯ãƒ­ãƒ–ãƒ­ã‚° API

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

æœ¬æ ¼çš„ãªãƒã‚¤ã‚¯ãƒ­ãƒ–ãƒ­ã‚° API ã‚’ Docker ã§æ§‹ç¯‰ã—ã¾ã™ã€‚

```mermaid
graph TB
    Client[ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ]
    
    subgraph Docker Network
        Nginx[Nginx<br/>ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·]
        API1[Flask API #1]
        API2[Flask API #2]
        Redis[(Redis<br/>ã‚­ãƒ£ãƒƒã‚·ãƒ¥)]
        MySQL[(MySQL<br/>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹)]
    end
    
    Client -->|:80| Nginx
    Nginx -->|Load Balance| API1
    Nginx -->|Load Balance| API2
    API1 --> Redis
    API2 --> Redis
    API1 --> MySQL
    API2 --> MySQL
```

### ãƒãƒ³ã‚ºã‚ªãƒ³: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹ç¯‰

```bash
mkdir -p ~/docker-practice/microblog/{api,nginx,mysql}
cd ~/docker-practice/microblog
```

#### 1. API ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³

```bash
# requirements.txt
cat << 'EOF' > api/requirements.txt
flask==3.0.0
gunicorn==21.2.0
mysql-connector-python==8.2.0
redis==5.0.1
python-dotenv==1.0.0
EOF

# app.py
cat << 'EOF' > api/app.py
import os
import json
import time
from datetime import datetime
from flask import Flask, request, jsonify
import mysql.connector
import redis

app = Flask(__name__)

# ç’°å¢ƒå¤‰æ•°ã‹ã‚‰è¨­å®šã‚’èª­ã¿è¾¼ã¿
MYSQL_HOST = os.getenv('MYSQL_HOST', 'mysql')
MYSQL_USER = os.getenv('MYSQL_USER', 'bloguser')
MYSQL_PASSWORD = os.getenv('MYSQL_PASSWORD', 'blogpass')
MYSQL_DATABASE = os.getenv('MYSQL_DATABASE', 'microblog')
REDIS_HOST = os.getenv('REDIS_HOST', 'redis')

def get_db():
    """ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚’å–å¾—"""
    for attempt in range(10):
        try:
            conn = mysql.connector.connect(
                host=MYSQL_HOST,
                user=MYSQL_USER,
                password=MYSQL_PASSWORD,
                database=MYSQL_DATABASE
            )
            return conn
        except mysql.connector.Error as e:
            print(f"DB connection attempt {attempt + 1} failed: {e}")
            time.sleep(2)
    raise Exception("Could not connect to database")

def get_redis():
    """Redis æ¥ç¶šã‚’å–å¾—"""
    return redis.Redis(host=REDIS_HOST, port=6379, decode_responses=True)

@app.route('/health')
def health():
    """ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯"""
    return jsonify({'status': 'healthy', 'timestamp': datetime.now().isoformat()})

@app.route('/api/posts', methods=['GET'])
def get_posts():
    """æŠ•ç¨¿ä¸€è¦§ã‚’å–å¾—ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ä»˜ãï¼‰"""
    r = get_redis()
    cache_key = 'posts:all'
    
    # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ãƒã‚§ãƒƒã‚¯
    cached = r.get(cache_key)
    if cached:
        return jsonify({'source': 'cache', 'posts': json.loads(cached)})
    
    # DB ã‹ã‚‰å–å¾—
    conn = get_db()
    cursor = conn.cursor(dictionary=True)
    cursor.execute('SELECT * FROM posts ORDER BY created_at DESC LIMIT 50')
    posts = cursor.fetchall()
    cursor.close()
    conn.close()
    
    # æ—¥ä»˜ã‚’ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºå¯èƒ½ã«
    for post in posts:
        if post.get('created_at'):
            post['created_at'] = post['created_at'].isoformat()
    
    # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜ï¼ˆ60ç§’ï¼‰
    r.setex(cache_key, 60, json.dumps(posts))
    
    return jsonify({'source': 'database', 'posts': posts})

@app.route('/api/posts', methods=['POST'])
def create_post():
    """æ–°è¦æŠ•ç¨¿ã‚’ä½œæˆ"""
    data = request.get_json()
    if not data or 'content' not in data:
        return jsonify({'error': 'Content is required'}), 400
    
    author = data.get('author', 'Anonymous')
    content = data['content']
    
    conn = get_db()
    cursor = conn.cursor()
    cursor.execute(
        'INSERT INTO posts (author, content) VALUES (%s, %s)',
        (author, content)
    )
    conn.commit()
    post_id = cursor.lastrowid
    cursor.close()
    conn.close()
    
    # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢
    r = get_redis()
    r.delete('posts:all')
    
    return jsonify({'id': post_id, 'author': author, 'content': content}), 201

@app.route('/api/posts/<int:post_id>', methods=['DELETE'])
def delete_post(post_id):
    """æŠ•ç¨¿ã‚’å‰Šé™¤"""
    conn = get_db()
    cursor = conn.cursor()
    cursor.execute('DELETE FROM posts WHERE id = %s', (post_id,))
    affected = cursor.rowcount
    conn.commit()
    cursor.close()
    conn.close()
    
    if affected == 0:
        return jsonify({'error': 'Post not found'}), 404
    
    # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢
    r = get_redis()
    r.delete('posts:all')
    
    return jsonify({'message': 'Deleted'}), 200

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000)
EOF

# Dockerfileï¼ˆæœ€é©åŒ–ç‰ˆï¼‰
cat << 'EOF' > api/Dockerfile
# Build stage
FROM python:3.11-slim AS builder
WORKDIR /app
RUN python -m venv /opt/venv
ENV PATH="/opt/venv/bin:$PATH"
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Runtime stage
FROM python:3.11-slim
WORKDIR /app

# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£: é root ãƒ¦ãƒ¼ã‚¶ãƒ¼
RUN groupadd -r api && \
    useradd -r -g api apiuser && \
    chown -R apiuser:api /app

# Python ç’°å¢ƒã‚’ã‚³ãƒ”ãƒ¼
COPY --from=builder /opt/venv /opt/venv
ENV PATH="/opt/venv/bin:$PATH"

USER apiuser
COPY --chown=apiuser:api app.py .

EXPOSE 5000

HEALTHCHECK --interval=30s --timeout=5s --start-period=10s \
    CMD python -c "import urllib.request; urllib.request.urlopen('http://localhost:5000/health')" || exit 1

CMD ["gunicorn", "-w", "2", "-b", "0.0.0.0:5000", "app:app"]
EOF
```

#### 2. MySQL åˆæœŸåŒ–

```bash
cat << 'EOF' > mysql/init.sql
CREATE DATABASE IF NOT EXISTS microblog;
USE microblog;

CREATE TABLE IF NOT EXISTS posts (
    id INT AUTO_INCREMENT PRIMARY KEY,
    author VARCHAR(100) NOT NULL DEFAULT 'Anonymous',
    content TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿
INSERT INTO posts (author, content) VALUES
    ('Admin', 'Welcome to Microblog!'),
    ('System', 'This is a sample post.');
EOF
```

#### 3. Nginx è¨­å®š

```bash
cat << 'EOF' > nginx/nginx.conf
upstream api_servers {
    least_conn;
    server api1:5000 weight=1;
    server api2:5000 weight=1;
}

server {
    listen 80;
    server_name localhost;

    location /health {
        access_log off;
        return 200 'OK';
        add_header Content-Type text/plain;
    }

    location / {
        proxy_pass http://api_servers;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_connect_timeout 30s;
        proxy_read_timeout 60s;
    }
}
EOF

cat << 'EOF' > nginx/Dockerfile
FROM nginx:alpine
RUN rm /etc/nginx/conf.d/default.conf
COPY nginx.conf /etc/nginx/conf.d/
HEALTHCHECK --interval=30s --timeout=3s \
    CMD wget --quiet --tries=1 --spider http://localhost/health || exit 1
EOF
```

#### 4. Docker Compose

```bash
cat << 'EOF' > docker-compose.yml
version: '3.8'

services:
  nginx:
    build: ./nginx
    ports:
      - "80:80"
    depends_on:
      api1:
        condition: service_healthy
      api2:
        condition: service_healthy
    networks:
      - frontend
    restart: unless-stopped

  api1:
    build: ./api
    environment:
      - MYSQL_HOST=mysql
      - MYSQL_USER=bloguser
      - MYSQL_PASSWORD=blogpass
      - MYSQL_DATABASE=microblog
      - REDIS_HOST=redis
    depends_on:
      mysql:
        condition: service_healthy
      redis:
        condition: service_healthy
    networks:
      - frontend
      - backend
    restart: unless-stopped

  api2:
    build: ./api
    environment:
      - MYSQL_HOST=mysql
      - MYSQL_USER=bloguser
      - MYSQL_PASSWORD=blogpass
      - MYSQL_DATABASE=microblog
      - REDIS_HOST=redis
    depends_on:
      mysql:
        condition: service_healthy
      redis:
        condition: service_healthy
    networks:
      - frontend
      - backend
    restart: unless-stopped

  mysql:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: rootpass
      MYSQL_DATABASE: microblog
      MYSQL_USER: bloguser
      MYSQL_PASSWORD: blogpass
    volumes:
      - mysql_data:/var/lib/mysql
      - ./mysql/init.sql:/docker-entrypoint-initdb.d/init.sql:ro
    networks:
      - backend
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost"]
      interval: 10s
      timeout: 5s
      retries: 5
    restart: unless-stopped

  redis:
    image: redis:7-alpine
    volumes:
      - redis_data:/data
    networks:
      - backend
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    restart: unless-stopped

networks:
  frontend:
    driver: bridge
  backend:
    driver: bridge

volumes:
  mysql_data:
  redis_data:
EOF
```

#### 5. èµ·å‹•ã¨å‹•ä½œç¢ºèª

```bash
# ãƒ“ãƒ«ãƒ‰ã¨èµ·å‹•
docker compose up -d --build

# ãƒ­ã‚°ç¢ºèª
docker compose logs -f

# çŠ¶æ…‹ç¢ºèªï¼ˆåˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ï¼‰
docker compose ps

# API ãƒ†ã‚¹ãƒˆ
# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
curl http://localhost/health

# æŠ•ç¨¿ä¸€è¦§å–å¾—
curl http://localhost/api/posts

# æ–°è¦æŠ•ç¨¿
curl -X POST http://localhost/api/posts \
  -H "Content-Type: application/json" \
  -d '{"author": "Test User", "content": "My first post!"}'

# å†åº¦å–å¾—ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ç¢ºèªï¼‰
curl http://localhost/api/posts

# ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°ç¢ºèªï¼ˆè¤‡æ•°å›å®Ÿè¡Œï¼‰
for i in {1..10}; do
  curl -s http://localhost/api/posts | jq -r '.source'
done

# åœæ­¢
docker compose down
```

## Docker ç·åˆãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### åŸºæœ¬æ“ä½œ

| ã‚«ãƒ†ã‚´ãƒª | é …ç›® | ãƒã‚§ãƒƒã‚¯ |
|---------|------|---------|
| ã‚³ãƒ³ãƒ†ãƒŠ | `docker run` ã§ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã§ãã‚‹ | â˜ |
| ã‚³ãƒ³ãƒ†ãƒŠ | `docker ps` ã§ç¨¼åƒä¸­ã‚³ãƒ³ãƒ†ãƒŠã‚’ç¢ºèªã§ãã‚‹ | â˜ |
| ã‚³ãƒ³ãƒ†ãƒŠ | `docker logs` ã§ãƒ­ã‚°ã‚’ç¢ºèªã§ãã‚‹ | â˜ |
| ã‚³ãƒ³ãƒ†ãƒŠ | `docker exec` ã§ã‚³ãƒ³ãƒ†ãƒŠå†…ã«å…¥ã‚Œã‚‹ | â˜ |
| ã‚¤ãƒ¡ãƒ¼ã‚¸ | `docker build` ã§ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œæˆã§ãã‚‹ | â˜ |
| ã‚¤ãƒ¡ãƒ¼ã‚¸ | `docker pull/push` ã§ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å–å¾—/é€ä¿¡ã§ãã‚‹ | â˜ |

### Dockerfile

| é …ç›® | ãƒã‚§ãƒƒã‚¯ |
|------|---------|
| FROM, RUN, COPY, CMD ã®å½¹å‰²ã‚’èª¬æ˜ã§ãã‚‹ | â˜ |
| EXPOSE, ENV, WORKDIR ã‚’é©åˆ‡ã«ä½¿ãˆã‚‹ | â˜ |
| ãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰ã‚’å®Ÿè£…ã§ãã‚‹ | â˜ |
| ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’è€ƒæ…®ã—ãŸé †åºã§è¨˜è¿°ã§ãã‚‹ | â˜ |
| é root ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ã®å®Ÿè¡Œã‚’è¨­å®šã§ãã‚‹ | â˜ |

### ãƒœãƒªãƒ¥ãƒ¼ãƒ ã¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯

| é …ç›® | ãƒã‚§ãƒƒã‚¯ |
|------|---------|
| Volume ã¨ Bind mount ã®é•ã„ã‚’èª¬æ˜ã§ãã‚‹ | â˜ |
| æ°¸ç¶šåŒ–ãŒå¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã‚’æ­£ã—ããƒã‚¦ãƒ³ãƒˆã§ãã‚‹ | â˜ |
| ã‚«ã‚¹ã‚¿ãƒ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½œæˆã§ãã‚‹ | â˜ |
| ã‚³ãƒ³ãƒ†ãƒŠé–“é€šä¿¡ã‚’ã‚µãƒ¼ãƒ“ã‚¹åã§è¡Œãˆã‚‹ | â˜ |

### Docker Compose

| é …ç›® | ãƒã‚§ãƒƒã‚¯ |
|------|---------|
| docker-compose.yml ã‚’æ›¸ã‘ã‚‹ | â˜ |
| è¤‡æ•°ã‚µãƒ¼ãƒ“ã‚¹ã®ä¾å­˜é–¢ä¿‚ã‚’è¨­å®šã§ãã‚‹ | â˜ |
| ç’°å¢ƒå¤‰æ•°ã‚’å¤–éƒ¨åŒ–ã§ãã‚‹ | â˜ |
| ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã¨ depends_on ã‚’çµ„ã¿åˆã‚ã›ã‚‰ã‚Œã‚‹ | â˜ |

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ—©è¦‹è¡¨

```bash
# ã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•ã—ãªã„
docker logs <container_name>         # ãƒ­ã‚°ç¢ºèª
docker inspect <container_name>      # è©³ç´°æƒ…å ±

# ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å•é¡Œ
docker network ls                    # ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸€è¦§
docker network inspect <network>     # æ¥ç¶šç¢ºèª
docker exec <container> ping <target> # ç–é€šç¢ºèª

# ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡å•é¡Œ
docker system df                     # ä½¿ç”¨é‡ç¢ºèª
docker system prune -a               # å…¨å‰Šé™¤ï¼ˆæ³¨æ„ï¼ï¼‰
docker image prune                   # æœªä½¿ç”¨ã‚¤ãƒ¡ãƒ¼ã‚¸å‰Šé™¤
docker volume prune                  # æœªä½¿ç”¨ãƒœãƒªãƒ¥ãƒ¼ãƒ å‰Šé™¤

# ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å•é¡Œ
docker stats                         # ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨çŠ¶æ³
docker top <container>               # ãƒ—ãƒ­ã‚»ã‚¹ç¢ºèª

# ãƒ“ãƒ«ãƒ‰ãŒå¤±æ•—
docker build --no-cache .            # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãªã—ã§ãƒ“ãƒ«ãƒ‰
docker build --progress=plain .      # è©³ç´°å‡ºåŠ›
```

## ã‚ˆãä½¿ã†ãƒ¯ãƒ³ãƒ©ã‚¤ãƒŠãƒ¼é›†

```bash
# åœæ­¢ä¸­ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’å…¨å‰Šé™¤
docker rm $(docker ps -aq -f status=exited)

# ã‚¿ã‚°ãªã—ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å‰Šé™¤
docker rmi $(docker images -f "dangling=true" -q)

# å…¨ã‚³ãƒ³ãƒ†ãƒŠåœæ­¢
docker stop $(docker ps -q)

# ç‰¹å®šã‚¤ãƒ¡ãƒ¼ã‚¸ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’è¦‹ã¤ã‘ã‚‹
docker ps -a --filter ancestor=nginx

# ã‚³ãƒ³ãƒ†ãƒŠã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–å¾—
docker inspect -f '{{range.NetworkSettings.Networks}}{{.IPAddress}}{{end}}' <container>

# ãƒ­ã‚°ã‚’ tail -f ã®ã‚ˆã†ã«è¦‹ã‚‹
docker logs -f --tail 100 <container>

# è¤‡æ•°ã‚³ãƒ³ãƒ†ãƒŠã®ä¸€æ‹¬å®Ÿè¡Œ
docker compose exec api1 python -c "print('Hello')"
```

## ç†è§£åº¦ç¢ºèª

### å•é¡Œ

ä»¥ä¸‹ã® docker-compose.yml ã§ã€api ã‚µãƒ¼ãƒ“ã‚¹ãŒ mysql ã‚ˆã‚Šå…ˆã«èµ·å‹•ã—ã¦ã—ã¾ã„ã€æ¥ç¶šã‚¨ãƒ©ãƒ¼ã«ãªã‚‹å•é¡Œã‚’è§£æ±ºã™ã‚‹æœ€ã‚‚é©åˆ‡ãªæ–¹æ³•ã¯ã©ã‚Œã‹ã€‚

```yaml
services:
  api:
    build: ./api
    depends_on:
      - mysql
  mysql:
    image: mysql:8.0
```

**A.** `depends_on` ã‚’å‰Šé™¤ã™ã‚‹

**B.** api ã‚µãƒ¼ãƒ“ã‚¹ã« `restart: always` ã‚’è¿½åŠ ã™ã‚‹

**C.** mysql ã‚µãƒ¼ãƒ“ã‚¹ã«ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚’è¿½åŠ ã—ã€`depends_on` ã‚’ `condition: service_healthy` ã«å¤‰æ›´ã™ã‚‹

**D.** api ã‚µãƒ¼ãƒ“ã‚¹ã® Dockerfile ã« `RUN sleep 30` ã‚’è¿½åŠ ã™ã‚‹

---

### è§£ç­”ãƒ»è§£èª¬

**æ­£è§£: C**

- **A.** èª¤ã‚Šã€‚ä¾å­˜é–¢ä¿‚ã‚’å‰Šé™¤ã™ã‚‹ã¨ã€èµ·å‹•é †åºãŒã•ã‚‰ã«ä¸å®šã«ãªã‚Šã¾ã™ã€‚
- **B.** éƒ¨åˆ†çš„ã«æ­£ã—ã„ã§ã™ãŒã€æ ¹æœ¬è§£æ±ºã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ä½•åº¦ã‚‚å†èµ·å‹•ã‚’ç¹°ã‚Šè¿”ã™ã®ã¯éåŠ¹ç‡ã§ã™ã€‚
- **C.** æ­£è§£ã€‚ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã§ mysql ãŒå®Ÿéš›ã«æ¥ç¶šå¯èƒ½ã«ãªã‚‹ã¾ã§ api ã®èµ·å‹•ã‚’å¾…ã¦ã¾ã™ã€‚

```yaml
services:
  api:
    depends_on:
      mysql:
        condition: service_healthy
  mysql:
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost"]
      interval: 5s
      timeout: 3s
      retries: 5
```

- **D.** èª¤ã‚Šã€‚å›ºå®šæ™‚é–“ã®ã‚¹ãƒªãƒ¼ãƒ—ã¯ç’°å¢ƒã«ã‚ˆã£ã¦ä¸è¶³/éå‰°ã«ãªã‚Šã¾ã™ã€‚

---

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

ğŸ‰ **ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼Dockerå…¥é–€ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ ã‚’å®Œäº†ã—ã¾ã—ãŸï¼**

### å­¦ç¿’ã®ç·ã¾ã¨ã‚

| Phase | å­¦ã‚“ã ã“ã¨ |
|-------|-----------|
| 0 | ç’°å¢ƒæ§‹ç¯‰ã€Docker Desktop ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« |
| 1 | ã‚³ãƒ³ãƒ†ãƒŠã®æ¦‚å¿µã€VM ã¨ã®é•ã„ |
| 2 | ã‚³ãƒ³ãƒ†ãƒŠã®åŸºæœ¬æ“ä½œã€ãƒãƒ¼ãƒˆãƒãƒƒãƒ”ãƒ³ã‚° |
| 3 | ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ä»•çµ„ã¿ã€Dockerfile ã®åŸºæœ¬ |
| 4 | ãƒœãƒªãƒ¥ãƒ¼ãƒ ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ |
| 5 | Docker Composeã€ãƒãƒ«ãƒã‚³ãƒ³ãƒ†ãƒŠ |
| 6 | æœ€é©åŒ–ã€ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ |

### æ¬¡ã«å­¦ã¶ã¹ãã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ 

Docker ã®çŸ¥è­˜ã‚’æ´»ã‹ã—ã¦ã€ä»¥ä¸‹ã®ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ ã«é€²ã¿ã¾ã—ã‚‡ã†ï¼š

1. **Kuberneteså…¥é–€** - ã‚³ãƒ³ãƒ†ãƒŠã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§æœ¬ç•ªé‹ç”¨
2. **CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³** - Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã®è‡ªå‹•ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤
3. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åŸºç¤** - MySQL/PostgreSQL ã®æœ¬æ ¼æ´»ç”¨

### ç¶™ç¶šçš„ãªå­¦ç¿’ã®ãŸã‚ã«

```bash
# Docker ã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
open https://docs.docker.com/

# Docker Hub ã§å…¬å¼ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æ¢ã™
open https://hub.docker.com/

# Play with Dockerï¼ˆç„¡æ–™ã®ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ç’°å¢ƒï¼‰
open https://labs.play-with-docker.com/
```

---

**ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼ğŸ³**
