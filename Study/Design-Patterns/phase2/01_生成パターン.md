# Phase 2-1: ç”Ÿæˆãƒ‘ã‚¿ãƒ¼ãƒ³ ï½ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç”Ÿæˆã‚’åˆ¶å¾¡ ï½

## å­¦ç¿’ç›®æ¨™

ã“ã®å˜å…ƒã‚’çµ‚ãˆã‚‹ã¨ã€ä»¥ä¸‹ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼š

- Factory ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆã‚’æŠ½è±¡åŒ–ã§ãã‚‹
- Singleton ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’é©åˆ‡ã«ä½¿ç”¨ã§ãã‚‹
- Builder ãƒ‘ã‚¿ãƒ¼ãƒ³ã§è¤‡é›‘ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ§‹ç¯‰ã§ãã‚‹

## æ¦‚å¿µè§£èª¬

### ç”Ÿæˆãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã¯

ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç”Ÿæˆãƒ—ãƒ­ã‚»ã‚¹ã‚’æŸ”è»Ÿã«ã—ã€ã‚³ãƒ¼ãƒ‰ã®çµåˆåº¦ã‚’ä¸‹ã’ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã€‚

```mermaid
mindmap
  root((ç”Ÿæˆãƒ‘ã‚¿ãƒ¼ãƒ³))
    Factory
      ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆã®æŠ½è±¡åŒ–
    Singleton
      å”¯ä¸€ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
    Builder
      è¤‡é›‘ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ§‹ç¯‰
    Prototype
      ã‚³ãƒ”ãƒ¼ã—ã¦ç”Ÿæˆ
```

## ãƒãƒ³ã‚ºã‚ªãƒ³

### æ¼”ç¿’1: Factory Method ãƒ‘ã‚¿ãƒ¼ãƒ³

```python
# âŒ ä½¿ã†å´ã§å…·ä½“çš„ãªã‚¯ãƒ©ã‚¹ã‚’çŸ¥ã£ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚‹
class PDFReport:
    def generate(self, data):
        return f"PDF: {data}"

class ExcelReport:
    def generate(self, data):
        return f"Excel: {data}"

# ä½¿ç”¨å´
def export_data(format_type, data):
    if format_type == "pdf":
        report = PDFReport()
    elif format_type == "excel":
        report = ExcelReport()
    # æ–°ã—ã„ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’è¿½åŠ ã™ã‚‹ãŸã³ã«ä¿®æ­£ãŒå¿…è¦
    return report.generate(data)
```

```python
# âœ… Factory Method ãƒ‘ã‚¿ãƒ¼ãƒ³
from abc import ABC, abstractmethod

# æŠ½è±¡ã‚¯ãƒ©ã‚¹
class Report(ABC):
    @abstractmethod
    def generate(self, data: str) -> str:
        pass

# å…·ä½“çš„ãªå®Ÿè£…
class PDFReport(Report):
    def generate(self, data: str) -> str:
        return f"ğŸ“„ PDF Report: {data}"

class ExcelReport(Report):
    def generate(self, data: str) -> str:
        return f"ğŸ“Š Excel Report: {data}"

class HTMLReport(Report):
    def generate(self, data: str) -> str:
        return f"ğŸŒ HTML Report: {data}"

# Factory
class ReportFactory:
    _reports = {
        "pdf": PDFReport,
        "excel": ExcelReport,
        "html": HTMLReport,
    }
    
    @classmethod
    def create(cls, format_type: str) -> Report:
        report_class = cls._reports.get(format_type)
        if not report_class:
            raise ValueError(f"Unknown format: {format_type}")
        return report_class()
    
    @classmethod
    def register(cls, format_type: str, report_class: type):
        """æ–°ã—ã„ãƒ¬ãƒãƒ¼ãƒˆã‚¿ã‚¤ãƒ—ã‚’ç™»éŒ²"""
        cls._reports[format_type] = report_class

# ä½¿ç”¨å´ã¯å…·ä½“çš„ãªã‚¯ãƒ©ã‚¹ã‚’çŸ¥ã‚‰ãªãã¦è‰¯ã„
def export_data(format_type: str, data: str) -> str:
    report = ReportFactory.create(format_type)
    return report.generate(data)

# ãƒ†ã‚¹ãƒˆ
print(export_data("pdf", "å£²ä¸Šãƒ‡ãƒ¼ã‚¿"))
print(export_data("excel", "åœ¨åº«ãƒ‡ãƒ¼ã‚¿"))
print(export_data("html", "é¡§å®¢ãƒ‡ãƒ¼ã‚¿"))

# æ–°ã—ã„ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’è¿½åŠ ï¼ˆæ—¢å­˜ã‚³ãƒ¼ãƒ‰ä¿®æ­£ãªã—ï¼‰
class CSVReport(Report):
    def generate(self, data: str) -> str:
        return f"ğŸ“‹ CSV Report: {data}"

ReportFactory.register("csv", CSVReport)
print(export_data("csv", "ãƒ­ã‚°ãƒ‡ãƒ¼ã‚¿"))
```

### æ¼”ç¿’2: Abstract Factory ãƒ‘ã‚¿ãƒ¼ãƒ³

```python
from abc import ABC, abstractmethod

# æŠ½è±¡ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆ
class Button(ABC):
    @abstractmethod
    def render(self) -> str:
        pass

class Input(ABC):
    @abstractmethod
    def render(self) -> str:
        pass

# å…·ä½“çš„ãªãƒ—ãƒ­ãƒ€ã‚¯ãƒˆï¼ˆMaterial Designï¼‰
class MaterialButton(Button):
    def render(self) -> str:
        return "<md-button>Click</md-button>"

class MaterialInput(Input):
    def render(self) -> str:
        return "<md-input placeholder='Enter text'/>"

# å…·ä½“çš„ãªãƒ—ãƒ­ãƒ€ã‚¯ãƒˆï¼ˆBootstrapï¼‰
class BootstrapButton(Button):
    def render(self) -> str:
        return "<button class='btn btn-primary'>Click</button>"

class BootstrapInput(Input):
    def render(self) -> str:
        return "<input class='form-control'/>"

# æŠ½è±¡ãƒ•ã‚¡ã‚¯ãƒˆãƒª
class UIFactory(ABC):
    @abstractmethod
    def create_button(self) -> Button:
        pass
    
    @abstractmethod
    def create_input(self) -> Input:
        pass

# å…·ä½“çš„ãªãƒ•ã‚¡ã‚¯ãƒˆãƒª
class MaterialUIFactory(UIFactory):
    def create_button(self) -> Button:
        return MaterialButton()
    
    def create_input(self) -> Input:
        return MaterialInput()

class BootstrapUIFactory(UIFactory):
    def create_button(self) -> Button:
        return BootstrapButton()
    
    def create_input(self) -> Input:
        return BootstrapInput()

# ä½¿ç”¨å´ï¼ˆã©ã®UIãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‹ã‚’æ„è­˜ã—ãªã„ï¼‰
class LoginForm:
    def __init__(self, ui_factory: UIFactory):
        self.button = ui_factory.create_button()
        self.input = ui_factory.create_input()
    
    def render(self) -> str:
        return f"""
        <form>
            {self.input.render()}
            {self.button.render()}
        </form>
        """

# ãƒ†ã‚¹ãƒˆ
material_form = LoginForm(MaterialUIFactory())
print("Material Design:")
print(material_form.render())

bootstrap_form = LoginForm(BootstrapUIFactory())
print("\nBootstrap:")
print(bootstrap_form.render())
```

### æ¼”ç¿’3: Singleton ãƒ‘ã‚¿ãƒ¼ãƒ³

```python
# âŒ æ‚ªã„ä¾‹ï¼šæ¯å›æ–°ã—ã„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
class DatabaseConnection:
    def __init__(self):
        print("Creating new connection...")
        self.connected = True

# è¤‡æ•°ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒä½œã‚‰ã‚Œã‚‹
conn1 = DatabaseConnection()
conn2 = DatabaseConnection()
print(conn1 is conn2)  # False
```

```python
# âœ… Singleton ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆPython çš„ãªå®Ÿè£…ï¼‰
class DatabaseConnection:
    _instance = None
    
    def __new__(cls):
        if cls._instance is None:
            cls._instance = super().__new__(cls)
            cls._instance._initialize()
        return cls._instance
    
    def _initialize(self):
        print("Creating new connection...")
        self.connected = True
    
    def query(self, sql: str):
        return f"Executing: {sql}"

# åŒã˜ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒè¿”ã•ã‚Œã‚‹
conn1 = DatabaseConnection()
conn2 = DatabaseConnection()
print(conn1 is conn2)  # True
print(conn1.query("SELECT * FROM users"))
```

```python
# âœ… ã‚ˆã‚Š Pythonic ãªå®Ÿè£…ï¼šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ¬ãƒ™ãƒ«å¤‰æ•°
# database.py
class _DatabaseConnection:
    def __init__(self):
        print("Creating new connection...")
        self.connected = True
    
    def query(self, sql: str):
        return f"Executing: {sql}"

# ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ¬ãƒ™ãƒ«ã§ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–
connection = _DatabaseConnection()

# ä½¿ç”¨å´
# from database import connection
# connection.query("SELECT * FROM users")
```

```python
# âš ï¸ Singleton ã®æ³¨æ„ç‚¹
# - ãƒ†ã‚¹ãƒˆãŒé›£ã—ããªã‚‹
- ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ã§å•é¡ŒãŒèµ·ãã‚‹å¯èƒ½æ€§
# - ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹ã¯é¿ã‘ã‚‹ã¹ã

# ä»£æ›¿æ¡ˆï¼šDIï¼ˆä¾å­˜æ€§æ³¨å…¥ï¼‰ã‚’ä½¿ã†
class UserService:
    def __init__(self, db_connection):  # å¤–éƒ¨ã‹ã‚‰æ³¨å…¥
        self.db = db_connection
```

### æ¼”ç¿’4: Builder ãƒ‘ã‚¿ãƒ¼ãƒ³

```python
# âŒ æ‚ªã„ä¾‹ï¼šã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã®å¼•æ•°ãŒå¤šã™ãã‚‹
class Email:
    def __init__(self, to, subject, body, cc=None, bcc=None, 
                 attachments=None, priority=None, html=False):
        self.to = to
        self.subject = subject
        self.body = body
        self.cc = cc or []
        self.bcc = bcc or []
        self.attachments = attachments or []
        self.priority = priority
        self.html = html

# ä½¿ã„ã«ãã„
email = Email("user@example.com", "Hello", "Body", None, None, 
              ["file.pdf"], "high", True)
```

```python
# âœ… Builder ãƒ‘ã‚¿ãƒ¼ãƒ³
from dataclasses import dataclass, field
from typing import Optional

@dataclass
class Email:
    to: str
    subject: str
    body: str
    cc: list[str] = field(default_factory=list)
    bcc: list[str] = field(default_factory=list)
    attachments: list[str] = field(default_factory=list)
    priority: Optional[str] = None
    html: bool = False

class EmailBuilder:
    def __init__(self):
        self._to = ""
        self._subject = ""
        self._body = ""
        self._cc = []
        self._bcc = []
        self._attachments = []
        self._priority = None
        self._html = False
    
    def to(self, address: str) -> 'EmailBuilder':
        self._to = address
        return self
    
    def subject(self, subject: str) -> 'EmailBuilder':
        self._subject = subject
        return self
    
    def body(self, body: str) -> 'EmailBuilder':
        self._body = body
        return self
    
    def cc(self, *addresses: str) -> 'EmailBuilder':
        self._cc.extend(addresses)
        return self
    
    def bcc(self, *addresses: str) -> 'EmailBuilder':
        self._bcc.extend(addresses)
        return self
    
    def attach(self, *files: str) -> 'EmailBuilder':
        self._attachments.extend(files)
        return self
    
    def priority(self, priority: str) -> 'EmailBuilder':
        self._priority = priority
        return self
    
    def as_html(self) -> 'EmailBuilder':
        self._html = True
        return self
    
    def build(self) -> Email:
        if not self._to:
            raise ValueError("Recipient is required")
        if not self._subject:
            raise ValueError("Subject is required")
        
        return Email(
            to=self._to,
            subject=self._subject,
            body=self._body,
            cc=self._cc,
            bcc=self._bcc,
            attachments=self._attachments,
            priority=self._priority,
            html=self._html
        )

# ä½¿ã„ã‚„ã™ã„ï¼
email = (EmailBuilder()
    .to("user@example.com")
    .subject("é‡è¦ãªãŠçŸ¥ã‚‰ã›")
    .body("<h1>Hello</h1>")
    .cc("manager@example.com")
    .attach("report.pdf", "data.xlsx")
    .priority("high")
    .as_html()
    .build())

print(email)
```

## ç”Ÿæˆãƒ‘ã‚¿ãƒ¼ãƒ³ã¾ã¨ã‚

| ãƒ‘ã‚¿ãƒ¼ãƒ³ | ç”¨é€” | ä½¿ç”¨å ´é¢ |
|---------|------|---------|
| Factory Method | ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆã®æŠ½è±¡åŒ– | ã‚¿ã‚¤ãƒ—ã«å¿œã˜ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆ |
| Abstract Factory | é–¢é€£ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç¾¤ã®ç”Ÿæˆ | UIãƒ†ãƒ¼ãƒã€ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å¯¾å¿œ |
| Singleton | å”¯ä¸€ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä¿è¨¼ | è¨­å®šã€DBæ¥ç¶šï¼ˆè¦æ³¨æ„ï¼‰ |
| Builder | è¤‡é›‘ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ§‹ç¯‰ | å¤šæ•°ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒã‚ã‚‹å ´åˆ |

## ç†è§£åº¦ç¢ºèª

### å•é¡Œ

ä»¥ä¸‹ã®è¦ä»¶ã«æœ€ã‚‚é©ã—ãŸãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ã©ã‚Œã‹ã€‚

ã€ŒHTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆã™ã‚‹ã€‚ãƒ¡ã‚½ãƒƒãƒ‰ã€URLã€ãƒ˜ãƒƒãƒ€ãƒ¼ã€ãƒœãƒ‡ã‚£ã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãªã©å¤šãã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã€æ®µéšçš„ã«è¨­å®šã—ãŸã„ã€‚ã€

**A.** Factory Method

**B.** Singleton

**C.** Builder

**D.** Abstract Factory

---

### è§£ç­”ãƒ»è§£èª¬

**æ­£è§£: C**

Builder ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ï¼š
- å¤šæ•°ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒã‚ã‚‹
- æ®µéšçš„ã«è¨­å®šã—ãŸã„
- æœ€å¾Œã«å®Œæˆã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å–å¾—

ã¨ã„ã†è¦ä»¶ã«æœ€é©ã§ã™ã€‚

```python
request = (HttpRequestBuilder()
    .method("POST")
    .url("https://api.example.com/users")
    .header("Content-Type", "application/json")
    .body({"name": "John"})
    .timeout(30)
    .build())
```

---

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

ç”Ÿæˆãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å­¦ã³ã¾ã—ãŸã€‚æ¬¡ã¯æ§‹é€ ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å­¦ã³ã¾ã—ã‚‡ã†ã€‚

**æ¬¡ã®å˜å…ƒ**: [Phase 2-2: æ§‹é€ ãƒ‘ã‚¿ãƒ¼ãƒ³](./02_æ§‹é€ ãƒ‘ã‚¿ãƒ¼ãƒ³.md)
