# Phase 3-1: æŒ¯ã‚‹èˆã„ãƒ‘ã‚¿ãƒ¼ãƒ³ ï½ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆé–“ã®é€£æº ï½

## å­¦ç¿’ç›®æ¨™

ã“ã®å˜å…ƒã‚’çµ‚ãˆã‚‹ã¨ã€ä»¥ä¸‹ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼š

- Strategy ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã‚‹
- Observer ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•è¨­è¨ˆãŒã§ãã‚‹
- Command ãƒ‘ã‚¿ãƒ¼ãƒ³ã§æ“ä½œã‚’ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆåŒ–ã§ãã‚‹

## ãƒãƒ³ã‚ºã‚ªãƒ³

### æ¼”ç¿’1: Strategy ãƒ‘ã‚¿ãƒ¼ãƒ³

**ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’äº¤æ›å¯èƒ½ã«ã™ã‚‹**

```python
# âŒ æ‚ªã„ä¾‹ï¼šæ¡ä»¶åˆ†å²ã®å¢—åŠ 
class ShippingCalculator:
    def calculate(self, order: dict, method: str) -> float:
        if method == "standard":
            return order["weight"] * 100
        elif method == "express":
            return order["weight"] * 200 + 500
        elif method == "same_day":
            return order["weight"] * 300 + 1000
        # æ–°ã—ã„é…é€æ–¹æ³•ã‚’è¿½åŠ ã™ã‚‹ãŸã³ã«ä¿®æ­£ãŒå¿…è¦
```

```python
# âœ… Strategy ãƒ‘ã‚¿ãƒ¼ãƒ³
from abc import ABC, abstractmethod

class ShippingStrategy(ABC):
    @abstractmethod
    def calculate(self, order: dict) -> float:
        pass
    
    @abstractmethod
    def get_estimated_days(self) -> int:
        pass

class StandardShipping(ShippingStrategy):
    def calculate(self, order: dict) -> float:
        return order["weight"] * 100
    
    def get_estimated_days(self) -> int:
        return 5

class ExpressShipping(ShippingStrategy):
    def calculate(self, order: dict) -> float:
        return order["weight"] * 200 + 500
    
    def get_estimated_days(self) -> int:
        return 2

class SameDayShipping(ShippingStrategy):
    def calculate(self, order: dict) -> float:
        return order["weight"] * 300 + 1000
    
    def get_estimated_days(self) -> int:
        return 0

class ShippingCalculator:
    def __init__(self, strategy: ShippingStrategy):
        self.strategy = strategy
    
    def set_strategy(self, strategy: ShippingStrategy):
        self.strategy = strategy
    
    def calculate(self, order: dict) -> dict:
        return {
            "cost": self.strategy.calculate(order),
            "days": self.strategy.get_estimated_days()
        }

# ä½¿ç”¨ä¾‹
order = {"weight": 2.5, "items": ["book", "pen"]}

calculator = ShippingCalculator(StandardShipping())
print(f"é€šå¸¸é…é€: {calculator.calculate(order)}")

calculator.set_strategy(ExpressShipping())
print(f"é€Ÿé”: {calculator.calculate(order)}")

calculator.set_strategy(SameDayShipping())
print(f"å½“æ—¥é…é€: {calculator.calculate(order)}")
```

```python
# å®Ÿè·µä¾‹ï¼šèªè¨¼æˆ¦ç•¥
class AuthStrategy(ABC):
    @abstractmethod
    def authenticate(self, credentials: dict) -> bool:
        pass

class PasswordAuth(AuthStrategy):
    def authenticate(self, credentials: dict) -> bool:
        return self._verify_password(credentials["username"], credentials["password"])
    
    def _verify_password(self, username, password):
        return True  # å®Ÿéš›ã¯DBç…§åˆ

class OAuth2Auth(AuthStrategy):
    def authenticate(self, credentials: dict) -> bool:
        return self._verify_token(credentials["access_token"])
    
    def _verify_token(self, token):
        return True  # å®Ÿéš›ã¯ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼

class APIKeyAuth(AuthStrategy):
    def authenticate(self, credentials: dict) -> bool:
        return self._verify_api_key(credentials["api_key"])
    
    def _verify_api_key(self, key):
        return True  # å®Ÿéš›ã¯ã‚­ãƒ¼æ¤œè¨¼

class AuthService:
    def __init__(self, strategy: AuthStrategy):
        self.strategy = strategy
    
    def login(self, credentials: dict) -> bool:
        return self.strategy.authenticate(credentials)
```

### æ¼”ç¿’2: Observer ãƒ‘ã‚¿ãƒ¼ãƒ³

**ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆé–“ã®1å¯¾å¤šã®ä¾å­˜é–¢ä¿‚ã‚’å®šç¾©**

```python
from abc import ABC, abstractmethod
from typing import List

# Observer ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
class Observer(ABC):
    @abstractmethod
    def update(self, event: str, data: dict):
        pass

# Subjectï¼ˆObservableï¼‰
class Subject:
    def __init__(self):
        self._observers: List[Observer] = []
    
    def attach(self, observer: Observer):
        self._observers.append(observer)
    
    def detach(self, observer: Observer):
        self._observers.remove(observer)
    
    def notify(self, event: str, data: dict):
        for observer in self._observers:
            observer.update(event, data)

# å…·ä½“çš„ãª Subject
class OrderService(Subject):
    def create_order(self, order: dict):
        # æ³¨æ–‡ä½œæˆãƒ­ã‚¸ãƒƒã‚¯
        order_id = "ORD001"
        print(f"Order created: {order_id}")
        
        # å…¨ã‚ªãƒ–ã‚¶ãƒ¼ãƒãƒ¼ã«é€šçŸ¥
        self.notify("order_created", {"order_id": order_id, **order})
        return order_id

# å…·ä½“çš„ãª Observer
class EmailNotifier(Observer):
    def update(self, event: str, data: dict):
        if event == "order_created":
            print(f"ğŸ“§ Sending confirmation email for order {data['order_id']}")

class InventoryUpdater(Observer):
    def update(self, event: str, data: dict):
        if event == "order_created":
            print(f"ğŸ“¦ Updating inventory for order {data['order_id']}")

class AnalyticsTracker(Observer):
    def update(self, event: str, data: dict):
        if event == "order_created":
            print(f"ğŸ“Š Tracking order event: {data['order_id']}")

class SlackNotifier(Observer):
    def update(self, event: str, data: dict):
        if event == "order_created":
            print(f"ğŸ’¬ Sending Slack notification: New order {data['order_id']}")

# ä½¿ç”¨ä¾‹
order_service = OrderService()

# ã‚ªãƒ–ã‚¶ãƒ¼ãƒãƒ¼ã‚’ç™»éŒ²
order_service.attach(EmailNotifier())
order_service.attach(InventoryUpdater())
order_service.attach(AnalyticsTracker())
order_service.attach(SlackNotifier())

# æ³¨æ–‡ä½œæˆï¼ˆã™ã¹ã¦ã®ã‚ªãƒ–ã‚¶ãƒ¼ãƒãƒ¼ã«è‡ªå‹•é€šçŸ¥ï¼‰
order_service.create_order({"product": "Laptop", "quantity": 1})
```

```python
# ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•å‹ã®å®Ÿè£…ä¾‹
from collections import defaultdict
from typing import Callable

class EventEmitter:
    def __init__(self):
        self._handlers = defaultdict(list)
    
    def on(self, event: str, handler: Callable):
        """ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã‚’ç™»éŒ²"""
        self._handlers[event].append(handler)
    
    def off(self, event: str, handler: Callable):
        """ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã‚’è§£é™¤"""
        self._handlers[event].remove(handler)
    
    def emit(self, event: str, *args, **kwargs):
        """ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºç«"""
        for handler in self._handlers[event]:
            handler(*args, **kwargs)

# ä½¿ç”¨ä¾‹
emitter = EventEmitter()

# ãƒãƒ³ãƒ‰ãƒ©ç™»éŒ²
emitter.on("user_registered", lambda user: print(f"Welcome {user['name']}!"))
emitter.on("user_registered", lambda user: print(f"Sending welcome email to {user['email']}"))

# ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«
emitter.emit("user_registered", {"name": "ç”°ä¸­", "email": "tanaka@example.com"})
```

### æ¼”ç¿’3: Command ãƒ‘ã‚¿ãƒ¼ãƒ³

**æ“ä½œã‚’ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦ã‚«ãƒ—ã‚»ãƒ«åŒ–**

```python
from abc import ABC, abstractmethod
from typing import List

# Command ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
class Command(ABC):
    @abstractmethod
    def execute(self):
        pass
    
    @abstractmethod
    def undo(self):
        pass

# Receiverï¼ˆå®Ÿéš›ã®å‡¦ç†ã‚’è¡Œã†ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰
class TextEditor:
    def __init__(self):
        self.content = ""
    
    def insert(self, text: str, position: int):
        self.content = self.content[:position] + text + self.content[position:]
    
    def delete(self, start: int, end: int) -> str:
        deleted = self.content[start:end]
        self.content = self.content[:start] + self.content[end:]
        return deleted

# å…·ä½“çš„ãª Command
class InsertCommand(Command):
    def __init__(self, editor: TextEditor, text: str, position: int):
        self.editor = editor
        self.text = text
        self.position = position
    
    def execute(self):
        self.editor.insert(self.text, self.position)
    
    def undo(self):
        self.editor.delete(self.position, self.position + len(self.text))

class DeleteCommand(Command):
    def __init__(self, editor: TextEditor, start: int, end: int):
        self.editor = editor
        self.start = start
        self.end = end
        self.deleted_text = ""
    
    def execute(self):
        self.deleted_text = self.editor.delete(self.start, self.end)
    
    def undo(self):
        self.editor.insert(self.deleted_text, self.start)

# Invokerï¼ˆã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œãƒ»ç®¡ç†ï¼‰
class CommandManager:
    def __init__(self):
        self._history: List[Command] = []
        self._redo_stack: List[Command] = []
    
    def execute(self, command: Command):
        command.execute()
        self._history.append(command)
        self._redo_stack.clear()
    
    def undo(self):
        if self._history:
            command = self._history.pop()
            command.undo()
            self._redo_stack.append(command)
    
    def redo(self):
        if self._redo_stack:
            command = self._redo_stack.pop()
            command.execute()
            self._history.append(command)

# ä½¿ç”¨ä¾‹
editor = TextEditor()
manager = CommandManager()

# ãƒ†ã‚­ã‚¹ãƒˆæ“ä½œ
manager.execute(InsertCommand(editor, "Hello", 0))
print(f"Insert: '{editor.content}'")

manager.execute(InsertCommand(editor, " World", 5))
print(f"Insert: '{editor.content}'")

manager.execute(DeleteCommand(editor, 5, 11))
print(f"Delete: '{editor.content}'")

# Undo
manager.undo()
print(f"Undo: '{editor.content}'")

manager.undo()
print(f"Undo: '{editor.content}'")

# Redo
manager.redo()
print(f"Redo: '{editor.content}'")
```

## æŒ¯ã‚‹èˆã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã¾ã¨ã‚

| ãƒ‘ã‚¿ãƒ¼ãƒ³ | ç”¨é€” | ä½¿ç”¨å ´é¢ |
|---------|------|---------|
| Strategy | ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ åˆ‡ã‚Šæ›¿ãˆ | é…é€æ–¹æ³•ã€æ”¯æ‰•ã„æ–¹æ³•ã€èªè¨¼ |
| Observer | ã‚¤ãƒ™ãƒ³ãƒˆé€šçŸ¥ | UIæ›´æ–°ã€é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ  |
| Command | æ“ä½œã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆåŒ– | Undo/Redoã€ã‚­ãƒ¥ãƒ¼ |
| State | çŠ¶æ…‹ã«å¿œã˜ãŸæŒ¯ã‚‹èˆã„ | ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã€ã‚²ãƒ¼ãƒ  |
| Template Method | ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®éª¨æ ¼å®šç¾© | ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ |

## ç†è§£åº¦ç¢ºèª

### å•é¡Œ

ECã‚µã‚¤ãƒˆã§æ³¨æ–‡ãŒç¢ºå®šã—ãŸã‚‰ã€Œãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã€ã€Œåœ¨åº«æ›´æ–°ã€ã€Œåˆ†æãƒ­ã‚°è¨˜éŒ²ã€ã‚’è¡Œã„ãŸã„ã€‚ã“ã‚Œã‚‰ã®å‡¦ç†ã‚’ç–çµåˆã«å®Ÿè£…ã™ã‚‹ã®ã«æœ€é©ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ã©ã‚Œã‹ã€‚

**A.** Strategy

**B.** Observer

**C.** Factory

**D.** Singleton

---

### è§£ç­”ãƒ»è§£èª¬

**æ­£è§£: B**

Observer ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ï¼š
- 1ã¤ã®ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆæ³¨æ–‡ç¢ºå®šï¼‰ã«å¯¾ã—ã¦
- è¤‡æ•°ã®å‡¦ç†ï¼ˆãƒ¡ãƒ¼ãƒ«ã€åœ¨åº«ã€åˆ†æï¼‰ã‚’
- ç–çµåˆã«å®Ÿè£…ã§ãã‚‹

OrderService ã¯å„å‡¦ç†ã®è©³ç´°ã‚’çŸ¥ã‚‹å¿…è¦ãŒãªãã€ã€Œæ³¨æ–‡ç¢ºå®šã€ã‚¤ãƒ™ãƒ³ãƒˆã‚’é€šçŸ¥ã™ã‚‹ã ã‘ã§ã€å„ Observer ãŒç‹¬è‡ªã«å‡¦ç†ã‚’è¡Œã„ã¾ã™ã€‚

---

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

æŒ¯ã‚‹èˆã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å­¦ã³ã¾ã—ãŸã€‚æ¬¡ã¯å®Ÿè·µã§ã‚ˆãä½¿ã†ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å­¦ã³ã¾ã—ã‚‡ã†ã€‚

**æ¬¡ã®å˜å…ƒ**: [Phase 3-2: ã‚ˆãä½¿ã†ãƒ‘ã‚¿ãƒ¼ãƒ³å®Ÿè·µ](./02_ã‚ˆãä½¿ã†ãƒ‘ã‚¿ãƒ¼ãƒ³å®Ÿè·µ.md)
