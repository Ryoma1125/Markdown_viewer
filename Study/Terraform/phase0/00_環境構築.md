# Phase 0: 環境構築

## 学習目標

この単元を終えると、以下ができるようになります：

- Terraform をインストールできる
- AWS CLI を設定できる
- 開発環境を整えられるAI CAI

## Terraform のインストール

### macOS（Homebrew）

```bash
# Homebrew でインストール
brew tap hashicorp/tap
brew install hashicorp/tap/terraform

# バージョン確認
terraform --version
```

### Linux（Ubuntu/Debian）

```bash
# HashiCorp GPG キーを追加
wget -O- https://apt.releases.hashicorp.com/gpg | sudo gpg --dearmor -o /usr/share/keyrings/hashicorp-archive-keyring.gpg

# リポジトリ追加
echo "deb [signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] https://apt.releases.hashicorp.com $(lsb_release -cs) main" | sudo tee /etc/apt/sources.list.d/hashicorp.list

# インストール
sudo apt update && sudo apt install terraform
```

### Windows

```powershell
# Chocolatey でインストール
choco install terraform

# または Scoop
scoop install terraform
```

### tfenv（バージョン管理）

```bash
# tfenv インストール（推奨）
brew install tfenv

# バージョン一覧
tfenv list-remote

# インストール
tfenv install 1.7.0

# 使用するバージョンを設定
tfenv use 1.7.0

# プロジェクトごとのバージョン指定
echo "1.7.0" > .terraform-version
```

## AWS CLI の設定

### インストール

```bash
# macOS
brew install awscli

# Linux
curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
unzip awscliv2.zip
sudo ./aws/install
```

### 認証設定

```bash
# IAM ユーザーの認証情報を設定
aws configure
# AWS Access Key ID: （アクセスキー）
# AWS Secret Access Key: （シークレットキー）
# Default region name: ap-northeast-1
# Default output format: json

# 確認
aws sts get-caller-identity
```

### 複数プロファイル

```bash
# ~/.aws/credentials
[default]
aws_access_key_id = AKIA...
aws_secret_access_key = ...

[dev]
aws_access_key_id = AKIA...
aws_secret_access_key = ...

[prod]
aws_access_key_id = AKIA...
aws_secret_access_key = ...
```

```bash
# プロファイル指定
aws s3 ls --profile dev
export AWS_PROFILE=dev
```

## VS Code 拡張機能

推奨拡張機能：

| 拡張機能 | 用途 |
|---------|------|
| HashiCorp Terraform | シンタックスハイライト、補完 |
| Terraform | フォーマット、リント |

## 動作確認

```bash
# 作業ディレクトリ作成
mkdir -p ~/terraform-practice
cd ~/terraform-practice

# 最初の Terraform ファイル
cat > main.tf << 'EOF'
terraform {
  required_version = ">= 1.0.0"
}

output "hello" {
  value = "Hello, Terraform!"
}
EOF

# 初期化
terraform init

# 実行
terraform apply
# "yes" と入力

# 出力を確認
# hello = "Hello, Terraform!"

# クリーンアップ
rm -rf .terraform* terraform.tfstate*
```

## ディレクトリ構成（推奨）

```
project/
├── main.tf           # メインの設定
├── variables.tf      # 変数定義
├── outputs.tf        # 出力定義
├── providers.tf      # プロバイダー設定
├── versions.tf       # バージョン制約
├── terraform.tfvars  # 変数の値
├── modules/          # ローカルモジュール
│   └── vpc/
└── environments/     # 環境別設定
    ├── dev/
    └── prod/
```

## 次のステップ

環境構築が完了しました。次は IaC の概念を学びましょう。

**次の単元**: [Phase 1-1: IaC とは](../phase1/01_IaCとは.md)
